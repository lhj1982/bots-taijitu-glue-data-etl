AWSTemplateFormatVersion: '2010-09-09'
Description: >
  Service role for glue data center account for bots-taijitu
  stackName=bots-taijitu-data-account-resources
Mappings:
  AccountMap:
    # China Prod
    "734147128161":
      OscarApiArn: "arn:aws-cn:execute-api:*:180957259698:*"
      OktaAdminRole: "arn:aws-cn:iam::734147128161:role/NIKE.SSO.AdminRole"
    # China Test
    "734176943427":
      OscarApiArn: "arn:aws-cn:execute-api:*:693031048477:*"
      OktaAdminRole: "arn:aws-cn:iam::734176943427:role/NIKE.SSO.AdminRole"
Resources:
  # GlueRuntimeServiceIAMRole:
  #   Type: AWS::IAM::Role
  #   Properties:
  #     RoleName: bots-taijitu-glue-runtime-service-role
  #     AssumeRolePolicyDocument:
  #       Version: '2012-10-17'
  #       Statement:
  #         - Effect: Allow
  #           Principal:
  #             Service:
  #               - glue.amazonaws.com
  #           Action:
  #             - sts:AssumeRole
  #     ManagedPolicyArns:
  #       - !Sub 'arn:${AWS::Partition}:iam::aws:policy/AmazonS3FullAccess'
  #       - !Sub 'arn:${AWS::Partition}:iam::aws:policy/AWSGlueConsoleFullAccess'
  #       - !Sub 'arn:${AWS::Partition}:iam::aws:policy/service-role/AwsGlueSessionUserRestrictedNotebookServiceRole'
  GlueInteractiveIAMRole:
    # DependsOn: GlueRuntimeServiceIAMRole
    Type: AWS::IAM::Role
    Properties:
      RoleName: bots-taijitu-glue-interactive-role
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - glue.amazonaws.com
            Action:
              - sts:AssumeRole
              - sts:TagSession
      ManagedPolicyArns:
        - !Sub 'arn:${AWS::Partition}:iam::aws:policy/AmazonS3FullAccess'
        - !Sub 'arn:${AWS::Partition}:iam::aws:policy/service-role/AWSGlueServiceRole'
        - !Sub 'arn:${AWS::Partition}:iam::aws:policy/AwsGlueSessionUserRestrictedNotebookPolicy'
      Path: '/'
      Policies:
        - PolicyName: bots-taijitu-glue-session-notebook-policy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Sid: AccessGlueNotebook
                Effect: Allow
                Action:
                  - iam:PassRole
                Resource:
                  - !Sub 'arn:${AWS::Partition}:iam::${AWS::AccountId}:role/*'
                Condition:
                  StringLike:
                    'iam:PassedToService':
                      - glue.amazonaws.com
  TaijituGlueDatabase:
    Type: AWS::Glue::Database
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseInput:
        Name: bots_taijitu_db
        Description: glue database for storing launch related bots taijitu tables from various sources