#!groovy
@Library('cicd-pipeline') _

def buildImage = 'artifactory.nike.com:9002/amazon/aws-cli:latest'

def config = [
    usePraDispatch: false,
    buildFlow: [
        DEPLOY_TEST: ['Build'],
        DEPLOY_PROD: ['Build'],
    ],
    branchMatcher: [
        DEPLOY_TEST: ['main']
    ],
    qma : [configFile: 'quality-config.yaml'],
    deploymentEnvironment:  [
        'cntest': [
            agentLabel      : 'china',
            deployFlow: [
                DEPLOY_TEST: ['Deploy'],
            ],
            cloudEnvironment: 'cntest',
            tags: [
                'Name': 'bots-taijitu-glue-waf-kafka',
                'costcenter': '161961',
                'classification': 'sliver',
                'email': 'Lst-gc-cdn-antibots.admin@nike.com',
                'owner': 'gc-cdn-antibots',
                'nike-department': 'platform engineering - gc launch',
                'nike-domain': 'gc-cdn-antibots',
                'nike-application': 'bots-taijitu-glue-waf-kafka',
                'nike-distributionlist': 'Lst-gc-cdn-antibots.admin@nike.com',
                'nike-owner': 'frank.zhao@nike.com',
                'nike-environment': 'cntest',
            ],
            deployCommand: [
                aws: [
                    roleAccount: '439314357471',
                    role: 'NIKE.cicd.tool',
                    region: 'cn-northwest-1',
                ],
                image: buildImage,
                cmd: "bash jenkins_deploy_command.sh \
                        ./etl-waf-kafka/waf_entry.py \
                        s3://bot-taijitu-etl-script/waf-kafka/waf_entry.py \
                        ./cloudformation/waf_kafka_resource.yaml \
                        bots-taijitu-waf-kafka-job \
                        test",
            ]
        ],
        'cnprod': [
            agentLabel      : 'china',
            deployFlow: [
                DEPLOY_PROD: ['Deploy'],
            ],
            cloudEnvironment: 'cnprod',
            tags: [
                'Name': 'bots-taijitu-glue-waf-kafka',
                'costcenter': '161961',
                'classification': 'sliver',
                'email': 'Lst-gc-cdn-antibots.admin@nike.com',
                'owner': 'gc-cdn-antibots',
                'nike-department': 'platform engineering - gc launch',
                'nike-domain': 'gc-cdn-antibots',
                'nike-application': 'bots-taijitu-glue-waf-kafka',
                'nike-distributionlist': 'Lst-gc-cdn-antibots.admin@nike.com',
                'nike-owner': 'frank.zhao@nike.com',
                'nike-environment': 'cnprod',
            ],
            deployCommand: [
                aws: [
                    roleAccount: '439413396736',
                    role: 'NIKE.cicd.tool',
                    region: 'cn-northwest-1',
                ],
                image: buildImage,
                cmd: "aws s3 cp ${params.CUSTOM_SCRIPT_LOCAL_PATH} ${params.CUSTOM_SCRIPT_S3_PATH}",
            ]
        ]
    ]
]

genericDeployPipeline(config)
